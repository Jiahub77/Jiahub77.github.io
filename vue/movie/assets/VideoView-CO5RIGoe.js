import{d as N,r,R as P,S as U,T as g,o as B,U as L,a as v,b as _,f as l,z as y,F as V,i as z,e as s,t as f,h as R,m,_ as F}from"./index-B3WSfOB5.js";const S={key:0},j={class:"item"},D={class:"title"},M=["poster","data-src"],O=["onClick"],$={class:"user"},q={class:"userInfo"},A=["src"],G={class:"icon"},H={class:"iconItem"},J={class:"iconItem"},K={class:"iconItem"},Q=N({__name:"VideoView",setup(W){const a=r([]),p=r(0);P().then(e=>{a.value=e.data.data.feeds.map(t=>({...t,isPlaying:!1}))});const b=r(0),u=r(!1),I=r(!1),T=()=>{u.value=!0,P(p.value).then(e=>{a.value&&(a.value=[...a.value,...e.data.data.feeds],u.value=!1,p.value=p.value+10,a.value.length>=100&&(I.value=!0))})},i=U("videos");console.log(i);const k=new IntersectionObserver(e=>{e.forEach(t=>{const n=t.target,c=a.value.findIndex(h=>h.video.url===n.dataset.src);c!==-1&&(t.isIntersecting?(n.src=n.dataset.src,n.play(),g(()=>{a.value[c].isPlaying=!0})):(n.pause(),a.value[c].isPlaying=!1))})},{threshold:1});B(()=>{g(()=>{setTimeout(()=>{var e;(e=i.value)==null||e.forEach(t=>{k.observe(t)})},1e3)})}),L(()=>{g(()=>{setTimeout(()=>{var e;(e=i.value)==null||e.forEach(t=>{k.unobserve(t)})},1e3)})});const w=e=>{a.value[e].isPlaying?i.value[e].pause():i.value[e].play(),a.value[e].isPlaying=!a.value[e].isPlaying};return(e,t)=>{const n=m("van-icon"),c=m("van-list"),h=m("van-tab"),x=m("van-tabs");return a.value?(v(),_("div",S,[l(x,{active:b.value,"onUpdate:active":t[1]||(t[1]=d=>b.value=d),animated:""},{default:y(()=>[(v(),_(V,null,z(["推荐","热片解读","新品预告"],d=>l(h,{title:d,key:d},{default:y(()=>[l(c,{loading:u.value,"onUpdate:loading":t[0]||(t[0]=o=>u.value=o),finished:I.value,"finished-text":"没有更多了",onLoad:T},{default:y(()=>[(v(!0),_(V,null,z(a.value,(o,E)=>{var C;return v(),_("div",{key:o.id,class:"video"},[s("div",j,[s("p",D,f(o.title),1),s("video",{controls:"",class:"video-player",ref_for:!0,ref:"videos",poster:o.images[0].url,muted:"","data-src":(C=o.video)==null?void 0:C.url},null,8,M),s("div",{class:"playIcon",onClick:X=>w(E)},[l(n,{name:o.isPlaying?"":"play-circle-o",size:"60",color:"#fff"},null,8,["name"])],8,O)]),s("div",$,[s("div",q,[s("img",{src:o.user.avatarurl,alt:""},null,8,A),s("span",null,f(o.user.nickName),1)]),s("div",G,[s("div",H,[l(n,{name:"good-job-o",size:"20",color:"#777"}),s("span",null,f(o.upCount),1)]),s("div",J,[l(n,{name:"chat-o",size:"20",color:"#777"}),s("span",null,f(o.commentCount),1)]),s("div",K,[l(n,{name:"share-o",size:"20",color:"#777"})])])])])}),128))]),_:1},8,["loading","finished"])]),_:2},1032,["title"])),64))]),_:1},8,["active"])])):R("",!0)}}}),Z=F(Q,[["__scopeId","data-v-dc01303b"]]);export{Z as default};
