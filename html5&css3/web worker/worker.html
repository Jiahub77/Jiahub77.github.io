<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    canvas {
        border: .0625rem solid #000;
    }
</style>

<body>
    <canvas width="300" height="300"></canvas>
    <input class="fib" type="text" value="1" name="" id="">
    <button>计算</button>
    <script>
        var input = document.querySelector('.fib')
        var canvas = document.querySelector('canvas')
        var btn = document.querySelector('button')
        var w = new Worker("./webWorker.js")
        // 主线程监听worker子线程发送过来的消息
        w.onmessage = function (e) {
            console.log("worker线程发送给主线程的消息", e, e.data);
        };
        btn.onclick = () => {
            var n = input.value;
            // 主线程向worker子线程发送消息
            w.postMessage(Number(n));
        };


        var ctx = canvas.getContext('2d')

        var drawDot = function (x, y, r, speedX, speedY, style) {
            this.x = x
            this.y = y
            this.r = r
            this.speedX = speedX
            this.speedY = speedY
            this.style = style
        }

        drawDot.prototype.draw = function () {
            ctx.beginPath()
            ctx.fillStyle = this.style
            ctx.arc(this.x, this.y, this.r, 0, 2 * Math.PI)
            ctx.fill()
        }

        drawDot.prototype.move = function () {
            this.x += this.speedX
            this.y += this.speedY
            if (this.x >= 300 - this.r || this.x <= this.r) {
                this.speedX = -this.speedX
            }
            if (this.y >= 300 - this.r || this.y <= this.r) {
                this.speedY = -this.speedY
            }
            this.draw()
        }

        var dots = []
        function random(m, n) {
            return Math.floor(Math.random() * (n - m) + m)
        }
        dots.push(new drawDot(random(10, 290), random(10, 290), random(5, 10), random(1, 5), random(1, 5), `rgb(${random(0, 255)},${random(0, 255)},${random(0, 255)})`))
        dots.push(new drawDot(random(10, 290), random(10, 290), random(5, 10), random(1, 5), random(1, 5), `rgb(${random(0, 255)},${random(0, 255)},${random(0, 255)})`))
        dots.push(new drawDot(random(10, 290), random(10, 290), random(5, 10), random(1, 5), random(1, 5), `rgb(${random(0, 255)},${random(0, 255)},${random(0, 255)})`))
        dots.push(new drawDot(random(10, 290), random(10, 290), random(5, 10), random(1, 5), random(1, 5), `rgb(${random(0, 255)},${random(0, 255)},${random(0, 255)})`))
        dots.forEach((dot) => {
            dot.draw()
        })
        setInterval(() => {
            ctx.clearRect(0, 0, 300, 300)

            dots.forEach((dot) => {
                dot.move()
            })
        }, 16.6)


    </script>
</body>

</html>